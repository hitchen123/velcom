"use strict";var childProcess=require("child_process"),fs=require("fs"),mote=require("mote"),wordwrap=require("wordwrap"),path=require("path"),moment=require("moment"),php="php";function generateLicenseAndVersionInfo(){var b=require(path.join(__dirname,"..","package.json"));var a=moment().format("YYYY-MM-DD");return{licenceComment:"/*!"+b.name+" v"+b.version+" "+a+"*/\n",versionInfo:b.version+" "+a}}function generateCode(){var a=path.join(__dirname,"export-config.php");childProcess.exec(php+" "+a,function(d,b,c){if(d){console.log(d.stack);console.log("Error code: "+d.code);console.log("Signal received: "+d.signal);return}var f=fs.readFileSync(path.join(__dirname,"mobile-detect.template.js"),"utf8"),i="{/*rules*/}",h=f.indexOf(i),g,e=generateLicenseAndVersionInfo();g=f.substring(0,h)+b+f.substring(h+i.length);g=addComments(g,b);g="// THIS FILE IS GENERATED - DO NOT EDIT!\n"+e.licenceComment+g;g=g.replace(/MOBILE_DETECT_VERSION/,e.versionInfo);fs.writeFileSync(path.join(__dirname,"..","mobile-detect.js"),g,"utf-8")})}function addComments(c,b){var e=JSON.parse(b),d={},a=wordwrap(80);["phones","tablets","oss","uas","props","utils"].forEach(function(f){var g=Object.keys(e[f]).join(", ");g=a(g).split(/\n/g);d[f]=g.join("\n         * ")});return mote.compile(c)({keys:d})}function generateTestData(){var a,e,d,c,b;a=fs.readFileSync(path.join(__dirname,"..","..","Mobile-Detect","tests","ualist.json"),"utf8");e=JSON.parse(a);d={};c=0;e.user_agents.forEach(function(f){var g=f.vendor;if("mobile" in f){delete f.vendor;f.nr=++c;d[g]=d[g]||[];d[g].push(f)}});b=["/* This file was generated - do not edit! */","/* hash = "+e.hash+" */","","var mobilePerVendor =",JSON.stringify(d,null,4)+";","",'if (typeof module !== "undefined") {',"    module.exports = mobilePerVendor;","}"].join("\n");fs.writeFileSync(path.join(__dirname,"..","tests","data","user-agents.js"),b,"utf-8")}generateCode();generateTestData();